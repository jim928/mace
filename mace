#!/usr/bin/env bash

version="0.1.3"

script_name=$(basename "$0")

usage() {
  cat <<EOF
Script name: $script_name
Description:
============

This is a script to config environment of mac dev in dev Apps
~/Library/Application Support/Google
~/Library/Developer/Xcode/UserData

Examples:
=========
    # config for all (AndroidStudio,Xcode)
    $script_name config
    # config for AndroidStudio
    $script_name configas
    # config for Xcode
    $script_name configxc
    # Show help
    $script_name -h
    # Show version
    $script_name -v
EOF
}

# shell cheat sheet https://devhints.io/bash

#homebrew 库的目录 ： /usr/local/Homebrew/Library/Taps/jim928

configAndroidStudioKeyMaps() {
  echo "now config for AndroidStudioKeyMaps"

  #android studio的快捷键配置文件路径举例为
  #~/Library/Application\ Support/Google/AndroidStudio2021.1/keymaps/macOS\ copy.xml
  #因此先找到已安装的所有AS不同版本文件夹

  cd /usr/local/Homebrew/Library/Taps/jim928

  #文件夹存在则删除
  if [ -d "keymapsas" ]; then
    rm -rf keymapsas
  fi

  git clone https://github.com/jim928/keymapsas.git

  #find . -name 'AndroidStudio*'
  cd ~/Library/Application\ Support/Google

  oldifs="$IFS"
  IFS=$'\n'
  file_paths=($(find . -name 'AndroidStudio*'))
  for file in "${file_paths[@]}"; do
    #    targetPath=${file:2} #将 ./AndroidStudio2021.1 截取为 AndroidStudio2021.1
    targetPath="${file:2}"
    echo $targetPath
    cd $targetPath

    if [ -d "keymaps" ]; then
      echo "dir keymaps exist"
    else
      echo "folder /keymaps not exist"
      sudo mkdir -p ./keymaps           #文件夹不存在则创建
      sudo chown -R $(id -un) ./keymaps # give permissions
    fi

    cp -r /usr/local/Homebrew/Library/Taps/jim928/keymapsas/* ./keymaps/
  done
  IFS="$oldifs" # 别忘了把IFS改回去

  echo "configAndroidStudioKeyMaps done"
}

configAndroidStudio() {
  configAndroidStudioKeyMaps
}

configXCode() {
  echo "now config for Xcode"

  cd /usr/local/Homebrew/Library/Taps/jim928

  #文件夹存在则删除
  if [ -d "CodeSnippets" ]; then
    rm -rf CodeSnippets
  fi

  git clone https://github.com/jim928/CodeSnippets.git

  #find . -name 'AndroidStudio*'
  cd ~/Library/Developer/Xcode/UserData

  if [ -d "CodeSnippets" ]; then
    echo "dir CodeSnippets exist"
  else
    echo "folder /CodeSnippets not exist , now mkdir"
    sudo mkdir -p ./CodeSnippets      #文件夹不存在则创建
    sudo chown -R $(id -un) ./CodeSnippets # give permissions
  fi

  cp -r /usr/local/Homebrew/Library/Taps/jim928/CodeSnippets/* ./CodeSnippets/
  echo "configXCode Done"
}

pushXCode() {
  echo "now push code to github for XCode"
}

while (($# > 0)); do # while arguments count>0
  case "$1" in
  #    -l | --lang)
  #        prog_lang=$2
  #        shift
  #        ;;
  #    -d | --dir)
  #        dir=$2
  #        shift 2
  #        ;;
  -h | --help)
    usage
    exit
    ;;
  -v | --version)
    echo ${version}
    exit
    ;;
  "configas")
    configAndroidStudioKeyMaps
    exit
    ;;
  "configxc")
    configXCode
    exit
    ;;
  "config")
    echo "now config for all"
    configAndroidStudioKeyMaps
    configXCode
    exit
    ;;
  *) # unknown flag/switch
    POSITIONAL+=("$1")
    shift
    ;;
  esac
done
